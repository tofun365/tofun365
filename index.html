<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å–®å­—ç‹ï½œäº’å‹•ç·´ç¿’ï¼ˆäº”å¹´ç´šï¼‰</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Sans TC', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 to-amber-50 text-gray-800">
  <div id="root" class="p-4"></div>

  <!-- React 18 + Babel + QRCodeJS -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // ====== è©åº«ï¼ˆæ ¸å¿ƒ / å»¶ä¼¸ / é€²éš / Phonicsï¼‰ ======
    const WORDS = [
      // ç¬¬ä¸‰å–®å…ƒæ ¸å¿ƒï¼ˆåœ°é»èˆ‡å‹•å‘ï½œ11ï¼‰
      { en: "bank", zh: "éŠ€è¡Œ", categories: ["core", "place"], phonics: null, compoundType: "none", icon: "ğŸ¦" },
      { en: "park", zh: "å…¬åœ’", categories: ["core", "place"], phonics: null, compoundType: "none", icon: "ğŸï¸" },
      { en: "bookstore", zh: "æ›¸åº—", categories: ["core", "place"], phonics: null, compoundType: "closed", icon: "ğŸª" },
      { en: "post office", zh: "éƒµå±€", categories: ["core", "place"], phonics: null, compoundType: "open", icon: "ğŸ¤" },
      { en: "hospital", zh: "é†«é™¢", categories: ["core", "place"], phonics: null, compoundType: "none", icon: "ğŸ¥" },
      { en: "library", zh: "åœ–æ›¸é¤¨", categories: ["core", "place"], phonics: null, compoundType: "none", icon: "ğŸ“š" },
      { en: "museum", zh: "åšç‰©é¤¨", categories: ["core", "place"], phonics: null, compoundType: "none", icon: "ğŸ›ï¸" },
      { en: "supermarket", zh: "è¶…ç´šå¸‚å ´", categories: ["core", "place"], phonics: null, compoundType: "closed", icon: "ğŸ›’" },
      { en: "go to ...", zh: "å»ï¼ˆæŸåœ°ï¼‰", categories: ["core"], phonics: null, compoundType: "none", icon: "â¡ï¸" },
      { en: "road", zh: "è·¯", categories: ["core", "place"], phonics: null, compoundType: "none", icon: "ğŸ›£ï¸" },
      { en: "street", zh: "è¡—", categories: ["core", "place"], phonics: null, compoundType: "none", icon: "ğŸ™ï¸" },

      // èª²æœ¬å»¶ä¼¸åœ°é»ï¼ˆ10ï¼‰
      { en: "airport", zh: "æ©Ÿå ´", categories: ["extended", "place"], phonics: null, compoundType: "closed", icon: "âœˆï¸" },
      { en: "bakery", zh: "éºµåŒ…åº—", categories: ["extended", "place"], phonics: null, compoundType: "none", icon: "ğŸ¥–" },
      { en: "bus station", zh: "å…¬è»Šç«™ï¼ˆå·´å£«ç¸½ç«™ï¼‰", categories: ["extended", "place"], phonics: null, compoundType: "open", icon: "ğŸšŒ" },
      { en: "convenience store", zh: "ä¾¿åˆ©å•†åº—", categories: ["extended", "place"], phonics: null, compoundType: "open", icon: "ğŸª" },
      { en: "fire station", zh: "æ¶ˆé˜²å±€", categories: ["extended", "place"], phonics: null, compoundType: "open", icon: "ğŸš’" },
      { en: "gas station", zh: "åŠ æ²¹ç«™", categories: ["extended", "place"], phonics: null, compoundType: "open", icon: "â›½" },
      { en: "police station", zh: "è­¦å¯Ÿå±€", categories: ["extended", "place"], phonics: null, compoundType: "open", icon: "ğŸ‘®â€â™‚ï¸" },
      { en: "school", zh: "å­¸æ ¡", categories: ["extended", "place"], phonics: null, compoundType: "none", icon: "ğŸ«" },
      { en: "temple", zh: "å»Ÿï¼å¯ºå»Ÿ", categories: ["extended", "place"], phonics: null, compoundType: "none", icon: "ğŸ›•" },
      { en: "alley", zh: "å··å­", categories: ["extended", "place"], phonics: null, compoundType: "none", icon: "ğŸ˜ï¸" },

      // é€²éšåŠ å¼·ï¼ˆçµ¦ç¨‹åº¦å¥½çš„å­©å­ï¼‰
      { en: "amusement park", zh: "éŠæ¨‚åœ’", categories: ["advanced", "place"], phonics: null, compoundType: "open", icon: "ğŸ¢" },
      { en: "Ferris wheel", zh: "æ‘©å¤©è¼ª", categories: ["advanced"], phonics: null, compoundType: "open", icon: "ğŸ¡" },
      { en: "castle", zh: "åŸå ¡", categories: ["advanced", "place"], phonics: null, compoundType: "none", icon: "ğŸ°" },
      { en: "exhibition", zh: "å±•è¦½", categories: ["advanced"], phonics: null, compoundType: "none", icon: "ğŸ–¼ï¸" },
      { en: "beach", zh: "æµ·ç˜", categories: ["advanced", "place"], phonics: null, compoundType: "none", icon: "ğŸ–ï¸" },
      { en: "mall", zh: "è³¼ç‰©ä¸­å¿ƒ", categories: ["advanced", "place"], phonics: null, compoundType: "none", icon: "ğŸ¬" },
      { en: "movie theater", zh: "é›»å½±é™¢", categories: ["advanced", "place"], phonics: null, compoundType: "open", icon: "ğŸ¦" },
      { en: "restaurant", zh: "é¤å»³", categories: ["advanced", "place"], phonics: null, compoundType: "none", icon: "ğŸ½ï¸" },
      { en: "sports center", zh: "é‹å‹•ä¸­å¿ƒ", categories: ["advanced", "place"], phonics: null, compoundType: "open", icon: "ğŸŸï¸" },
      { en: "train station", zh: "ç«è»Šç«™", categories: ["advanced", "place"], phonics: null, compoundType: "open", icon: "ğŸš‰" },

      // Phonics an/ankï¼ˆ7ï¼‰
      { en: "can", zh: "èƒ½å¤ ï¼›ç½é ­", categories: ["phonics"], phonics: "an", compoundType: "none", icon: "ğŸ¥«" },
      { en: "fan", zh: "é›»æ‰‡ï¼›è¿·", categories: ["phonics"], phonics: "an", compoundType: "none", icon: "ğŸŒ€" },
      { en: "hand", zh: "æ‰‹", categories: ["phonics"], phonics: "an", compoundType: "none", icon: "âœ‹" },
      { en: "sand", zh: "æ²™", categories: ["phonics"], phonics: "an", compoundType: "none", icon: "ğŸ–ï¸" },
      { en: "thank", zh: "æ„Ÿè¬", categories: ["phonics"], phonics: "ank", compoundType: "none", icon: "ğŸ™" },
      { en: "tank", zh: "å¦å…‹ï¼›æ°´æ§½", categories: ["phonics"], phonics: "ank", compoundType: "none", icon: "ğŸ›¢ï¸" },
      { en: "blank", zh: "ç©ºç™½", categories: ["phonics"], phonics: "ank", compoundType: "none", icon: "â¬œ" },

      // Phonics ar/ark/artï¼ˆ7ï¼‰
      { en: "car", zh: "æ±½è»Š", categories: ["phonics"], phonics: "ar", compoundType: "none", icon: "ğŸš—" },
      { en: "star", zh: "æ˜Ÿæ˜Ÿ", categories: ["phonics"], phonics: "ar", compoundType: "none", icon: "â­" },
      { en: "dark", zh: "é»‘æš—çš„", categories: ["phonics"], phonics: "ark", compoundType: "none", icon: "ğŸŒ™" },
      { en: "shark", zh: "é¯Šé­š", categories: ["phonics"], phonics: "ark", compoundType: "none", icon: "ğŸ¦ˆ" },
      { en: "part", zh: "éƒ¨åˆ†", categories: ["phonics"], phonics: "art", compoundType: "none", icon: "ğŸ§©" },
      { en: "start", zh: "é–‹å§‹", categories: ["phonics"], phonics: "art", compoundType: "none", icon: "â–¶ï¸" },
      { en: "smart", zh: "è°æ˜çš„", categories: ["phonics"], phonics: "art", compoundType: "none", icon: "ğŸ§ " },

      // Phonics o_eï¼oaï¼owï¼ˆ15ï¼‰
      { en: "note", zh: "ç­†è¨˜ï¼›ä¾¿æ¢", categories: ["phonics"], phonics: "o_e", compoundType: "none", icon: "ğŸ“" },
      { en: "rose", zh: "ç«ç‘°èŠ±", categories: ["phonics"], phonics: "o_e", compoundType: "none", icon: "ğŸŒ¹" },
      { en: "boat", zh: "èˆ¹", categories: ["phonics"], phonics: "oa", compoundType: "none", icon: "â›µ" },
      { en: "goat", zh: "å±±ç¾Š", categories: ["phonics"], phonics: "oa", compoundType: "none", icon: "ğŸ" },
      { en: "low", zh: "ä½çš„", categories: ["phonics"], phonics: "ow_oÊŠ", compoundType: "none", icon: "â¬‡ï¸" },
      { en: "row", zh: "åˆ’èˆ¹", categories: ["phonics"], phonics: "ow_oÊŠ", compoundType: "none", icon: "ğŸš£" },
      { en: "home", zh: "å®¶", categories: ["phonics"], phonics: "o_e", compoundType: "none", icon: "ğŸ " },
      { en: "nose", zh: "é¼»å­", categories: ["phonics"], phonics: "o_e", compoundType: "none", icon: "ğŸ‘ƒ" },
      { en: "rope", zh: "ç¹©å­", categories: ["phonics"], phonics: "o_e", compoundType: "none", icon: "ğŸª¢" },
      { en: "coat", zh: "å¤–å¥—", categories: ["phonics"], phonics: "oa", compoundType: "none", icon: "ğŸ§¥" },
      { en: "soap", zh: "è‚¥çš‚", categories: ["phonics"], phonics: "oa", compoundType: "none", icon: "ğŸ§¼" },
      { en: "snow", zh: "é›ª", categories: ["phonics"], phonics: "ow_oÊŠ", compoundType: "none", icon: "â„ï¸" },
      { en: "slow", zh: "ç·©æ…¢çš„", categories: ["phonics"], phonics: "ow_oÊŠ", compoundType: "none", icon: "ğŸ¢" },
      { en: "grow", zh: "ç”Ÿé•·", categories: ["phonics"], phonics: "ow_oÊŠ", compoundType: "none", icon: "ğŸŒ±" },
      { en: "show", zh: "å±•ç¤ºï¼›è¡¨æ¼”", categories: ["phonics"], phonics: "ow_oÊŠ", compoundType: "none", icon: "ğŸ¬" },
    ];

    const PHONICS_GROUPS = [
      { key: 'an', label: 'an' }, { key: 'ank', label: 'ank' }, { key: 'ar', label: 'ar' }, { key: 'ark', label: 'ark' }, { key: 'art', label: 'art' }, { key: 'o_e', label: 'o_e' }, { key: 'oa', label: 'oa' }, { key: 'ow_oÊŠ', label: 'ow (/oÊŠ/)' },
    ];

    // ====== å…§å»ºåœ–ç‰‡ï¼šSVG ç”¢ç”Ÿ + å°‘é‡å®¢è£½åœ–ç¤º ======
    function svgData(svg){ return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`; }
    function makeTile(emoji, label){
      const colors = ["#E3F2FD","#FCE4EC","#E8F5E9","#FFF3E0","#E1F5FE","#F3E5F5","#FFFDE7","#EDE7F6","#F1F8E9","#ECEFF1"];
      let hash = 0; for (let i=0;i<label.length;i++) hash=((hash<<5)-hash)+label.charCodeAt(i);
      const bg = colors[Math.abs(hash)%colors.length];
      const txt = label.length>14? label.slice(0,13)+"â€¦" : label;
      return svgData(`
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
          <rect width='160' height='120' rx='14' ry='14' fill='${bg}'/>
          <text x='80' y='62' font-size='56' text-anchor='middle' dominant-baseline='central' font-family='Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji'>${emoji||"ğŸ–¼ï¸"}</text>
          <text x='80' y='106' font-size='14' text-anchor='middle' fill='#374151' font-family='ui-sans-serif, system-ui'>${txt}</text>
        </svg>`);
    }

    const DEMO_PACK = {
      bank: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#FFF8E1'/>
        <polygon points='80,15 15,45 145,45' fill='#FDD835'/>
        <rect x='25' y='45' width='110' height='10' fill='#5D4037'/>
        <rect x='35' y='55' width='10' height='45' fill='#8D6E63'/>
        <rect x='60' y='55' width='10' height='45' fill='#8D6E63'/>
        <rect x='85' y='55' width='10' height='45' fill='#8D6E63'/>
        <rect x='110' y='55' width='10' height='45' fill='#8D6E63'/>
      </svg>`),
      park: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#E8F5E9'/>
        <circle cx='55' cy='55' r='24' fill='#66BB6A'/>
        <rect x='52' y='60' width='6' height='30' fill='#8D6E63'/>
        <rect x='90' y='75' width='50' height='8' fill='#795548'/>
        <rect x='100' y='70' width='6' height='20' fill='#5D4037'/>
      </svg>`),
      "post office": svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#FFF3E0'/>
        <rect x='30' y='35' width='100' height='60' rx='6' fill='#FFB74D'/>
        <polygon points='30,35 80,65 130,35' fill='#F57C00'/>
        <rect x='45' y='50' width='70' height='25' fill='#FFE0B2'/>
        <line x1='45' y1='50' x2='115' y2='75' stroke='#F57C00' stroke-width='3'/>
        <line x1='115' y1='50' x2='45' y2='75' stroke='#F57C00' stroke-width='3'/>
      </svg>`),
      beach: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#E1F5FE'/>
        <circle cx='130' cy='25' r='14' fill='#FFEE58'/>
        <rect x='0' y='70' width='160' height='50' fill='#FFE082'/>
        <path d='M0 70 Q20 60 40 70 T80 70 T120 70 T160 70' fill='none' stroke='#29B6F6' stroke-width='6'/>
      </svg>`),
      restaurant: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#FFEBEE'/>
        <circle cx='80' cy='70' r='28' fill='#EF9A9A'/>
        <rect x='50' y='30' width='6' height='28' fill='#B71C1C'/>
        <rect x='60' y='30' width='6' height='28' fill='#B71C1C'/>
        <rect x='104' y='30' width='6' height='28' fill='#880E4F'/>
        <rect x='98' y='30' width='6' height='28' fill='#880E4F'/>
      </svg>`),
      "amusement park": svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#F3E5F5'/>
        <path d='M10 90 C40 40, 120 40, 150 90' fill='none' stroke='#8E24AA' stroke-width='6'/>
        <circle cx='40' cy='60' r='4' fill='#8E24AA'/>
        <circle cx='80' cy='50' r='4' fill='#8E24AA'/>
        <circle cx='120' cy='60' r='4' fill='#8E24AA'/>
      </svg>`),
      "Ferris wheel": svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#EDE7F6'/>
        <circle cx='80' cy='60' r='32' fill='none' stroke='#5E35B1' stroke-width='6'/>
        <line x1='80' y1='28' x2='80' y2='92' stroke='#5E35B1' stroke-width='4'/>
        <line x1='48' y1='60' x2='112' y2='60' stroke='#5E35B1' stroke-width='4'/>
        <line x1='58' y1='38' x2='102' y2='82' stroke='#5E35B1' stroke-width='4'/>
        <line x1='102' y1='38' x2='58' y2='82' stroke='#5E35B1' stroke-width='4'/>
      </svg>`),
      castle: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#E0F7FA'/>
        <rect x='30' y='55' width='100' height='45' fill='#90A4AE'/>
        <rect x='30' y='40' width='20' height='15' fill='#78909C'/>
        <rect x='110' y='40' width='20' height='15' fill='#78909C'/>
        <polygon points='40,40 50,25 60,40' fill='#78909C'/>
        <polygon points='110,40 120,25 130,40' fill='#78909C'/>
        <rect x='70' y='70' width='20' height='30' fill='#607D8B'/>
      </svg>`),
      exhibition: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#FFFDE7'/>
        <rect x='30' y='30' width='100' height='70' fill='#FFF59D' stroke='#FBC02D' stroke-width='6'/>
        <polygon points='45,85 80,50 115,85' fill='#FBC02D'/>
      </svg>`),
      mall: svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#F1F8E9'/>
        <rect x='25' y='45' width='110' height='50' fill='#AED581'/>
        <rect x='35' y='55' width='25' height='20' fill='#8BC34A'/>
        <rect x='70' y='55' width='25' height='20' fill='#8BC34A'/>
        <rect x='105' y='55' width='25' height='20' fill='#8BC34A'/>
      </svg>`),
      "movie theater": svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#ECEFF1'/>
        <rect x='25' y='25' width='110' height='60' fill='#90A4AE'/>
        <rect x='35' y='35' width='90' height='40' fill='#263238'/>
        <rect x='45' y='90' width='70' height='10' fill='#607D8B'/>
      </svg>`),
      "sports center": svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#E8EAF6'/>
        <circle cx='55' cy='60' r='16' fill='#3949AB'/>
        <line x1='80' y1='45' x2='120' y2='75' stroke='#5C6BC0' stroke-width='10' stroke-linecap='round'/>
      </svg>`),
      "train station": svgData(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'>
        <rect width='160' height='120' fill='#FBE9E7'/>
        <rect x='45' y='30' width='70' height='50' rx='8' fill='#D84315'/>
        <rect x='50' y='35' width='60' height='26' fill='#FFCCBC'/>
        <line x1='20' y1='95' x2='140' y2='95' stroke='#6D4C41' stroke-width='6'/>
        <line x1='30' y1='105' x2='130' y2='105' stroke='#6D4C41' stroke-width='6'/>
      </svg>`),
    };

    const BUILTIN_SVGS = WORDS.reduce((acc, w) => { acc[w.en] = DEMO_PACK[w.en] || makeTile(w.icon || "ğŸ–¼ï¸", w.en); return acc; }, {});

    // ====== å·¥å…·å‡½å¼ ======
    function speak(text){ try{ const s = window.speechSynthesis; if(!s) return; const u = new SpeechSynthesisUtterance(text); u.lang='en-US'; u.rate=0.95; s.cancel(); setTimeout(()=>s.speak(u),0); }catch{} }
    function shuffle(arr, seed=Math.random()){
      const a = arr.slice(); let s = Math.floor(seed*1e9)||42;
      for(let i=a.length-1;i>0;i--){ s=(1664525*s+1013904223)%0xffffffff; const j=s%(i+1); [a[i],a[j]]=[a[j],a[i]]; }
      return a;
    }
    function todaySeed(){ const d=new Date(); const y=d.getFullYear(); const m=d.getMonth()+1; const day=d.getDate(); return Number(`${y}${String(m).padStart(2,'0')}${String(day).padStart(2,'0')}`)/1e8; }

    // ====== UI åŸºä»¶ ======
    function Tag({children}){ return <span className="inline-block rounded-full border px-2 py-0.5 text-xs text-gray-600 border-gray-300">{children}</span>; }
    function cardStyle(){ return "rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"; }
    function Picture({ src, icon }){ return (<div className="mb-3 flex h-40 items-center justify-center overflow-hidden rounded-2xl bg-gray-50">{src ? (<img src={src} alt="illustration" className="h-full w-full object-contain" />) : (<div className="select-none text-6xl" aria-hidden>{icon || 'ğŸ–¼ï¸'}</div>)}</div>); }

    // ====== App æ ¹å…ƒä»¶ ======
    function App(){
      const [mode, setMode] = useState('flash');
      const [filter, setFilter] = useState('all');
      const [shuffleOn, setShuffleOn] = useState(true);
      const [showImages, setShowImages] = useState(true);
      const [fillMissing, setFillMissing] = useState(true);
      const [packUrl, setPackUrl] = useState('');
      const [packStatus, setPackStatus] = useState('idle');
      const [packImages, setPackImages] = useState({});
      const [shareOpen, setShareOpen] = useState(false);

      // URL ?pack= åƒæ•¸è‡ªå‹•å¸¶å…¥
      useEffect(()=>{ try{ const p=new URLSearchParams(location.search).get('pack'); if(p) setPackUrl(p); }catch{} },[]);

      // è®€å– JSON åœ–ç‰‡åŒ…ï¼ˆå¯é¸ï¼‰
      useEffect(()=>{
        if(!packUrl){ setPackImages({}); setPackStatus('idle'); return; }
        (async()=>{
          try{ setPackStatus('loading'); const res=await fetch(packUrl,{cache:'no-store'}); if(!res.ok) throw new Error(res.statusText); const json=await res.json(); setPackImages(json||{}); setPackStatus('ok'); }
          catch{ setPackImages({}); setPackStatus('error'); }
        })();
      },[packUrl]);

      const filtered = useMemo(()=>{
        if(filter==='all') return WORDS; if(filter==='phonics') return WORDS.filter(w=>w.categories.includes('phonics'));
        return WORDS.filter(w=>w.categories.includes(filter));
      },[filter]);

      const deck = useMemo(()=> shuffleOn ? shuffle(filtered) : filtered, [filtered, shuffleOn]);

      const useOnlyBuiltIn = packStatus!=='ok' || Object.keys(packImages).length===0;
      const activePack = useOnlyBuiltIn ? BUILTIN_SVGS : (fillMissing ? {...BUILTIN_SVGS, ...packImages} : packImages);
      const imgFor = (en)=> showImages ? (activePack[en] || null) : null;

      useEffect(()=>{ if(!shareOpen) return; const box = document.getElementById('qr-box'); if(box){ box.innerHTML=''; new QRCode(box, { text: window.location.href, width: 220, height: 220 }); } }, [shareOpen]);

      return (
        <div className="mx-auto max-w-5xl">
          <header className="mb-4 flex items-baseline justify-between gap-3">
            <h1 className="text-2xl font-bold">å–®å­—ç‹ï½œäº’å‹•ç·´ç¿’ï¼ˆäº”å¹´ç´šï¼‰</h1>
            <div className="flex items-center gap-2 text-xs text-gray-500">
              <span>{useOnlyBuiltIn ? 'ä½¿ç”¨å…§å»º SVGï¼ˆå…¨è¦†è“‹ï¼‰' : (fillMissing ? 'å·²è¼‰å…¥å…±äº«åœ–ï¼‹å…§å»ºè£œé½Š' : 'å·²è¼‰å…¥å…±äº«åœ–')}</span>
              <button onClick={()=>setShareOpen(true)} className="rounded-lg border border-gray-300 bg-white px-2 py-1 hover:bg-gray-50">åˆ†äº«/QR</button>
            </div>
          </header>

          {/* æ¨¡å¼å·¥å…·åˆ— */}
          <div className="mb-4 flex flex-wrap gap-2">
            {[['flash','Flashcards å¡ç‰‡'],['spell','Spelling æ‹¼å­—'],['phonics','Phonics åˆ†é¡'],['compound','åˆå¯«ï¼åˆ†å¯«'],['daily','æ¯æ—¥ 5 å­—']].map(([k,label])=> (
              <button key={k} onClick={()=>setMode(k)} className={`rounded-2xl px-3 py-1.5 text-sm ${mode===k?'bg-black text-white':'bg-white hover:bg-gray-100 border border-gray-300'}`}>{label}</button>
            ))}
          </div>

          {/* ç¯©é¸èˆ‡è¨­å®š */}
          <div className="mb-6 rounded-2xl border border-gray-200 bg-white/70 p-4 shadow-sm">
            <div className="mb-3 flex items-center justify-between">
              <div className="flex flex-col gap-2 md:flex-row md:items-center md:gap-4">
                <h2 className="text-lg font-semibold">ç¯©é¸èˆ‡è¨­å®š</h2>
                <div className="flex flex-wrap gap-2 text-xs">
                  {['all','core','extended','advanced','phonics','place'].map(k=> (
                    <button key={k} onClick={()=>setFilter(k)} className={`rounded-xl px-2 py-1 border ${filter===k?'bg-blue-600 text-white border-blue-600':'bg-white hover:bg-gray-50 border-gray-300'}`}>
                      {k==='all'? 'å…¨éƒ¨': k==='core'? 'ç¬¬ä¸‰å–®å…ƒæ ¸å¿ƒ': k==='extended'? 'èª²æœ¬å»¶ä¼¸': k==='advanced'? 'é€²éšåŠ å¼·': k==='phonics'? 'Phonics å®¶æ—':'åœ°é»é¡'}
                    </button>
                  ))}
                </div>
              </div>
              <label className="flex items-center gap-2 text-xs text-gray-700"><input type="checkbox" className="accent-black" checked={shuffleOn} onChange={e=>setShuffleOn(e.target.checked)} />éš¨æ©Ÿ</label>
            </div>

            <div className="flex flex-col gap-2 md:flex-row md:items-center">
              <label className="flex w-full items-center gap-2 text-xs text-gray-700">
                <span className="w-28 shrink-0">ç­ç´šå…±äº«åœ–ç‰‡</span>
                <input type="url" className="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black" value={packUrl} onChange={e=>setPackUrl(e.target.value)} placeholder="ï¼ˆå¯ç•¥éï¼‰è²¼ JSON é€£çµï¼Œå¯è¦†è“‹åœ–ç‰‡" />
              </label>
              <div className="flex shrink-0 items-center gap-3">
                <label className="flex items-center gap-2 text-xs text-gray-700"><input type="checkbox" className="accent-black" checked={fillMissing} onChange={e=>setFillMissing(e.target.checked)} />ç¼ºåœ–æ™‚ç”¨å…§å»ºè£œé½Š</label>
                <label className="flex items-center gap-2 text-xs text-gray-700"><input type="checkbox" className="accent-black" checked={showImages} onChange={e=>setShowImages(e.target.checked)} />é¡¯ç¤ºåœ–ç‰‡</label>
              </div>
            </div>
            <div className="mt-2 text-[11px] leading-relaxed text-gray-500">å¯åœ¨ç¶²å€å¾ŒåŠ  <b>?pack=</b> æŒ‡å®š JSONã€‚æœªæä¾›æˆ–è®€å–å¤±æ•—æœƒè‡ªå‹•ä½¿ç”¨å…§å»ºåœ–ã€‚</div>
          </div>

          {mode==='flash' && <Flashcards deck={deck} imgFor={imgFor} />}
          {mode==='spell' && <Spelling pool={deck} />}
          {mode==='phonics' && <PhonicsGame words={WORDS.filter(w=>w.categories.includes('phonics'))} />}
          {mode==='compound' && <CompoundGame words={WORDS.filter(w=>w.compoundType!=='none')} />}
          {mode==='daily' && <DailyFive all={WORDS} imgFor={imgFor} />}

          <footer className="mt-10 text-center text-xs text-gray-500">æç¤ºï¼šæœ—è®€è‹¥æ²’è²éŸ³ï¼Œè«‹å…ˆåœ¨é é¢ä»»æ„é»ä¸€ä¸‹å†æŒ‰ ğŸ”Šï¼Œæˆ–æ”¹ç”¨ Chrome / Edgeã€‚</footer>

          {shareOpen && (
            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
              <div className="w-[360px] rounded-2xl bg-white p-4 shadow-xl">
                <div className="mb-2 flex items-center justify-between">
                  <div className="font-semibold">åˆ†äº«æ­¤é </div>
                  <button className="rounded-lg px-2 py-1 text-sm hover:bg-gray-100" onClick={()=>setShareOpen(false)}>é—œé–‰</button>
                </div>
                <div id="qr-box" className="mx-auto my-2 flex h-[240px] w-[240px] items-center justify-center rounded-xl border border-gray-200"></div>
                <div className="text-xs text-gray-600 break-all">{window.location.href}</div>
                <div className="mt-3 flex items-center justify-end gap-2">
                  <button className="rounded-lg border border-gray-300 px-3 py-1.5 text-sm hover:bg-gray-50" onClick={()=>{navigator.clipboard?.writeText(window.location.href)}}>è¤‡è£½é€£çµ</button>
                  <button className="rounded-lg bg-black px-3 py-1.5 text-sm text-white" onClick={()=>window.print()}>åˆ—å°</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ====== å„æ¨¡å¼å…ƒä»¶ ======
    function Flashcards({ deck, imgFor }){
      const [idx, setIdx] = useState(0); const [flipped, setFlipped] = useState(false);
      const total = deck.length; const w = deck[idx]; if(!w) return null;
      useEffect(()=>{ const onKey = (e)=>{ if(e.key==='ArrowLeft') setIdx(i=>(i-1+total)%total); if(e.key==='ArrowRight') setIdx(i=>(i+1)%total); if(e.key===' '){ e.preventDefault(); setFlipped(f=>!f);} }; window.addEventListener('keydown', onKey); return ()=>window.removeEventListener('keydown', onKey); }, [total]);
      return (
        <div className="grid grid-cols-1 gap-4 md:grid-cols-[1fr_320px]">
          <div className={cardStyle()+" cursor-pointer transition-transform hover:scale-[1.01]"} onClick={()=>setFlipped(f=>!f)}>
            <div className="flex items-start justify-between">
              <div className="text-xs text-gray-500">{idx+1}/{total}</div>
              <div className="flex items-center gap-2">
                {w.compoundType && w.compoundType!=='none' && <Tag>{w.compoundType==='closed'?'åˆå¯«':'åˆ†å¯«'}</Tag>}
                {w.categories.includes('place') && <Tag>åœ°é»</Tag>}
                {w.categories.includes('advanced') && <span className="inline-block rounded-full border border-amber-400 bg-amber-50 px-2 py-0.5 text-xs text-amber-700">é€²éš</span>}
              </div>
            </div>
            <Picture src={imgFor(w.en)} icon={w.icon} />
            <div className="mt-2 text-center">
              {!flipped ? (<><div className="mb-3 text-4xl font-black tracking-wide">{w.en}</div><div className="text-sm text-gray-500">é»æ“Šç¿»é¢ / Click to flip</div></>) : (<><div className="mb-2 text-2xl font-semibold">{w.zh}</div><div className="text-sm text-gray-500">{w.en}</div></>)}
            </div>
          </div>
          <div className="space-y-3">
            <div className={cardStyle()+" p-4"}>
              <div className="mb-2 flex items-center justify-between"><div className="font-medium">å·¥å…·</div><button onClick={()=>speak(w.en)} className="rounded-xl border border-gray-300 bg-white px-2 py-1 text-xs hover:bg-gray-50" aria-label="æœ—è®€">ğŸ”Š æœ—è®€</button></div>
              <div className="flex flex-wrap gap-2">
                <button onClick={()=>setFlipped(f=>!f)} className="rounded-xl bg-black px-3 py-1.5 text-white">ç¿»é¢ (ç©ºç™½éµ)</button>
                <button onClick={()=>setIdx(i=>(i-1+total)%total)} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 hover:bg-gray-50">ä¸Šä¸€å¼µ (â†)</button>
                <button onClick={()=>setIdx(i=>(i+1)%total)} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 hover:bg-gray-50">ä¸‹ä¸€å¼µ (â†’)</button>
                <button onClick={()=>setIdx(Math.floor(Math.random()*total))} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 hover:bg-gray-50">éš¨æ©Ÿä¸€å¼µ</button>
              </div>
              <div className="pt-1 text-xs text-gray-600">è‹¥è²¼äº†ç­ç´š JSONï¼Œå‹¾é¸ã€Œç¼ºåœ–æ™‚ç”¨å…§å»ºè£œé½Šã€å¯è®“æ²’åˆ—åˆ°çš„å–®å­—ä»é¡¯ç¤ºå…§å»ºåœ–ã€‚</div>
            </div>
          </div>
        </div>
      );
    }

    function normalize(s){ return s.toLowerCase().replace(/\s+/g,' ').trim(); }
    function Spelling({ pool }){
      const [i,setI]=useState(0); const [answer,setAnswer]=useState(''); const [result,setResult]=useState(null); const [score,setScore]=useState({correct:0,total:0});
      const w = pool[i]; if(!w) return null; function submit(){ const ok=normalize(answer)===normalize(w.en); setResult(ok); setScore(s=>({correct:s.correct+(ok?1:0), total:s.total+1})); }
      function next(){ setI(x=>(x+1)%pool.length); setAnswer(''); setResult(null);} 
      return (
        <div className="grid grid-cols-1 gap-4 md:grid-cols-[1fr_320px]">
          <div className={cardStyle()}>
            <div className="mb-1 text-xs text-gray-500">ä¸­æ–‡æç¤º</div>
            <div className="mb-4 text-2xl font-semibold">{w.zh}</div>
            <div className="mb-3 text-sm text-gray-500">æç¤ºé¡åˆ¥ï¼š{w.categories.includes('phonics')?'Phonics': w.categories.includes('place')?'åœ°é»': w.categories.includes('advanced')?'é€²éš':'ä¸€èˆ¬'}</div>
            <div className="flex items-center gap-2">
              <input className="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black" placeholder="è«‹è¼¸å…¥è‹±æ–‡æ‹¼å­—" value={answer} onChange={e=>setAnswer(e.target.value)} onKeyDown={e=>{if(e.key==='Enter') submit();}} />
              <button onClick={submit} className="rounded-xl bg-black px-4 py-2 text-white">é€å‡º</button>
            </div>
            {result!==null && (<div className={`mt-4 rounded-xl p-3 text-sm ${result?'bg-emerald-50 text-emerald-700':'bg-rose-50 text-rose-700'}`}>{result? 'å¤ªæ£’äº†ï¼Œæ­£ç¢ºï¼' : <div>å†è©¦ä¸€æ¬¡ï½ æ­£è§£ï¼š<b className="font-semibold">{w.en}</b></div>}</div>)}
          </div>
          <div className={cardStyle()+" space-y-2 p-4"}>
            <div className="font-medium">å°å·¥å…·</div>
            <button onClick={()=>speak(w.en)} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 text-sm hover:bg-gray-50">ğŸ”Š æ’­æ”¾å–®å­—</button>
            <button onClick={next} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 text-sm hover:bg-gray-50">ä¸‹ä¸€é¡Œ</button>
            <div className="pt-2 text-xs text-gray-600">å¾—åˆ†ï¼š{score.correct}/{score.total}</div>
          </div>
        </div>
      );
    }

    function PhonicsGame({ words }){
      const candidates = useMemo(()=> shuffle(words).slice(0,10), [words]);
      const [idx,setIdx]=useState(0); const [fb,setFb]=useState(null); const w=candidates[idx]; if(!w) return null;
      function pick(key){ const ok=w.phonics===key; setFb(ok?{ok:true,msg:'æ­£ç¢ºï¼'}:{ok:false,msg:`å†æƒ³æƒ³ï½ æ­£ç¢ºæ˜¯ ${w.phonics}`}); setTimeout(()=>{ setFb(null); setIdx(i=>(i+1)%candidates.length); }, 700); }
      return (
        <div className={cardStyle()}>
          <div className="mb-1 text-xs text-gray-500">è«‹é¸å‡ºæ­¤å­—çš„ç™¼éŸ³å®¶æ—</div>
          <div className="mb-4 text-center text-4xl font-black tracking-wide">{w.en}</div>
          <div className="mb-4 text-center text-sm text-gray-500">{w.zh}</div>
          <div className="grid grid-cols-2 gap-2 md:grid-cols-4">{PHONICS_GROUPS.map(g=>(<button key={g.key} onClick={()=>pick(g.key)} className="rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm hover:bg-gray-50">{g.label}</button>))}</div>
          {fb && (<div className={`mt-4 rounded-xl p-3 text-center text-sm ${fb.ok?'bg-emerald-50 text-emerald-700':'bg-rose-50 text-rose-700'}`}>{fb.msg}</div>)}
        </div>
      );
    }

    function CompoundGame({ words }){
      const items = useMemo(()=> shuffle(words).slice(0,10), [words]);
      const [idx,setIdx]=useState(0); const [fb,setFb]=useState(null); const w=items[idx]; if(!w) return null;
      function choose(type){ const ok=w.compoundType===type; setFb(ok?{ok:true,msg:'ç­”å°ï¼'}:{ok:false,msg:`æ­£ç¢ºæ˜¯ï¼š${w.compoundType==='closed'?'åˆå¯« [C]':'åˆ†å¯« [O]'}`}); setTimeout(()=>{ setFb(null); setIdx(i=>(i+1)%items.length); }, 700); }
      return (
        <div className={cardStyle()+" text-center"}>
          <div className="mb-1 text-xs text-gray-500">è«‹åˆ¤æ–·æœ¬å­—æ˜¯åˆå¯«ï¼ˆClosedï¼‰é‚„æ˜¯åˆ†å¯«ï¼ˆOpenï¼‰</div>
          <div className="mb-4 text-4xl font-black tracking-wide">{w.en}</div>
          <div className="mb-4 text-sm text-gray-500">{w.zh}</div>
          <div className="flex items-center justify-center gap-2">
            <button onClick={()=>choose('closed')} className="rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm hover:bg-gray-50">åˆå¯« [C]</button>
            <button onClick={()=>choose('open')} className="rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm hover:bg-gray-50">åˆ†å¯« [O]</button>
          </div>
          {fb && (<div className={`mt-4 rounded-xl p-3 text-sm ${fb.ok?'bg-emerald-50 text-emerald-700':'bg-rose-50 text-rose-700'}`}>{fb.msg}</div>)}
        </div>
      );
    }

    function DailyFive({ all, imgFor }){
      const [seed,setSeed]=useState(todaySeed());
      const five = useMemo(()=> shuffle(all, seed).slice(0,5), [all, seed]);
      function copy(){ const text=five.map((w,i)=>`${i+1}. ${w.en} â€” ${w.zh}`).join('\n'); navigator.clipboard?.writeText(text); alert('å·²è¤‡è£½ä»Šæ—¥ 5 å­—ï¼'); }
      function printList(){ const w=window.open('', '_blank'); if(!w) return; const list=five.map(w=>`<li><b>${w.en}</b> â€” ${w.zh}</li>`).join(''); w.document.write(`<!doctype html><meta charset='utf-8'/><title>ä»Šæ—¥ 5 å­—</title><style>body{font-family:ui-sans-serif,system-ui; padding:24px} h1{font-size:20px} li{margin:8px 0}</style><h1>ä»Šæ—¥ 5 å­—</h1><ol>${list}</ol>`); w.document.close(); w.focus(); w.print(); }
      return (
        <div className={cardStyle()}>
          <div className="mb-2 text-sm text-gray-600">ä¾æ—¥æœŸç”¢ç”Ÿå›ºå®š 5 å­—ã€‚å¯è¤‡è£½æˆ–åˆ—å°æˆå°å¡ã€‚</div>
          <ol className="mb-4 list-decimal space-y-2 pl-5">
            {five.map((w,i)=> (
              <li key={i} className="flex items-center justify-between gap-2">
                <div className="flex items-center gap-3">
                  <div className="h-10 w-10 overflow-hidden rounded-xl bg-gray-50">
                    {imgFor(w.en) ? (<img src={imgFor(w.en)} alt="thumb" className="h-full w-full object-contain" />) : (<div className="flex h-full w-full select-none items-center justify-center text-2xl">{w.icon || 'ğŸ–¼ï¸'}</div>)}
                  </div>
                  <div>
                    <div className="font-semibold">{w.en}</div>
                    <div className="text-xs text-gray-500">{w.zh}</div>
                  </div>
                </div>
                <button onClick={()=>speak(w.en)} className="rounded-lg border border-gray-300 bg-white px-2 py-1 text-xs">ğŸ”Š</button>
              </li>
            ))}
          </ol>
          <div className="flex flex-wrap items-center gap-2">
            <button onClick={()=>setSeed(todaySeed())} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 text-sm hover:bg-gray-50">ä»Šå¤©</button>
            <button onClick={()=>setSeed(Math.random())} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 text-sm hover:bg-gray-50">æ›ä¸€çµ„</button>
            <button onClick={copy} className="rounded-xl bg-black px-3 py-1.5 text-sm text-white">è¤‡è£½</button>
            <button onClick={printList} className="rounded-xl border border-gray-300 bg-white px-3 py-1.5 text-sm hover:bg-gray-50">åˆ—å°</button>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>